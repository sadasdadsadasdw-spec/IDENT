==================================================
ТЕСТОВЫЕ CURL КОМАНДЫ ДЛЯ ПОИСКА ЛИДА ПО ТЕЛЕФОНУ
==================================================

ЗАМЕНИТЕ В КОМАНДАХ:
- YOUR_WEBHOOK_URL → ваш webhook URL (из config.ini)
- PHONE_NUMBER → реальный номер телефона лида

==================================================
КОМАНДА 1: Обычный поиск через crm.lead.list
==================================================

curl -X POST "YOUR_WEBHOOK_URL/crm.lead.list" \
  -H "Content-Type: application/json" \
  -d '{
    "filter": {
      "PHONE": "PHONE_NUMBER"
    },
    "select": ["ID", "TITLE", "STATUS_ID", "CONTACT_ID", "PHONE"]
  }'

ПРИМЕР:
curl -X POST "https://myportal.bitrix24.ru/rest/1/abc123/crm.lead.list" \
  -H "Content-Type: application/json" \
  -d '{
    "filter": {
      "PHONE": "+79991234567"
    },
    "select": ["ID", "TITLE", "STATUS_ID", "CONTACT_ID", "PHONE"]
  }'

==================================================
КОМАНДА 2: Batch запрос (как в коде интеграции)
==================================================

curl -X POST "YOUR_WEBHOOK_URL/batch" \
  -H "Content-Type: application/json" \
  -d '{
    "halt": 0,
    "cmd": {
      "PHONE_NUMBER": "crm.lead.list?filter[PHONE]=ENCODED_PHONE&select[]=ID&select[]=STATUS_ID&select[]=CONTACT_ID"
    }
  }'

ПРИМЕР (замените %2B на + в номере):
curl -X POST "https://myportal.bitrix24.ru/rest/1/abc123/batch" \
  -H "Content-Type: application/json" \
  -d '{
    "halt": 0,
    "cmd": {
      "+79991234567": "crm.lead.list?filter[PHONE]=%2B79991234567&select[]=ID&select[]=STATUS_ID&select[]=CONTACT_ID"
    }
  }'

==================================================
КОМАНДА 3: Получить лид по ID (если нашли в шаге 1)
==================================================

curl -X POST "YOUR_WEBHOOK_URL/crm.lead.get" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "LEAD_ID"
  }'

ПРИМЕР:
curl -X POST "https://myportal.bitrix24.ru/rest/1/abc123/crm.lead.get" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "123"
  }'

==================================================
ЧТО ПРОВЕРИТЬ В РЕЗУЛЬТАТАХ:
==================================================

1. В КОМАНДЕ 1/2 ищем:
   - "result": [...] - массив найденных лидов
   - Если массив ПУСТОЙ [] - лид НЕ найден по телефону
   - Если есть элементы - лид НАЙДЕН

2. Проверяем в найденном лиде:
   - "ID": "123" - ID лида
   - "CONTACT_ID": "456" - ID связанного контакта (если есть)
   - "PHONE": [...] - телефоны ЛИДА (может быть пусто если телефон в контакте)

3. В КОМАНДЕ 3 (crm.lead.get) проверяем полные данные:
   - "PHONE": [...] - все телефоны лида
   - Если PHONE пустой но CONTACT_ID есть - телефон хранится в контакте!

==================================================
ВЫВОД КОМАНД:
==================================================

Выполните команды и предоставьте результаты:
1. Результат КОМАНДЫ 1 или 2
2. Если лид найден - результат КОМАНДЫ 3 с его полными данными
3. Укажите: есть ли у этого лида связанный контакт (CONTACT_ID)
